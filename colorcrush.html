<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Crush</title>
    <link rel="icon" type="image/x-icon" href="src/icon.png">
    <style>


        body{
            background-color: lightgrey;
            padding-top: 10px;
        }


        #container{
            width: 720px;
            margin: auto;
            background-color: white;
            border-radius: 5px;
            border: solid 10px black;
            padding: 10px;
            background-color: lightcyan;
        }
        
        #scoreboard{
            width: fit-content;
            margin: 0px auto;
        }
        
        .magenta{
            background-color: magenta;
        }

        .none{
            background-color: none;
        }

        .red{
            background-color: red;
        }

        #buttons{
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 50px;
        }

        #buttons button{
            width: 100%;
        }

    </style>
    <script>

        let pontszam;
        let cl;
        let tomb = [];
        let html = "";
        let p;
        let ocurrent = null;
        let chosen = 0;

        function start(){
            pontszam = 0;
            cl = 0;
            document.getElementById("container").innerHTML = "";
            html = "";
            for (let i = 0; i < 6; i++){
                tomb[i] = [];
                for (let j = 0; j < 10; j++){
                    tomb[i][j] = Math.floor(Math.random()*5+1);
                    html += "<img class='none' id='"+i+"x"+j+"' onmouseout='out(\""+i+"\",\""+j+"\");' onmouseover='over(\""+i+"\",\""+j+"\");' onclick='katt(\""+i+"\",\""+j+"\");' src='src/box"+tomb[i][j]+".png'>";
                }
            }
            document.getElementById("container").innerHTML = html;
            document.getElementById("click").innerHTML = cl;
            document.getElementById("score").innerHTML = pontszam;
        }

        
        function katt(i, j){
            if(tomb[i][j] != 0){
                p = 0;
                current = tomb[i][j];
                for (let i = 0; i < 6; i++){
                    for (let j = 0; j < 10; j++){
                        if (document.getElementById(i+"x"+j).getAttribute("class") == "magenta"){
                            document.getElementById(i+"x"+j).setAttribute("class", "none")
                            document.getElementById(i+"x"+j).src = "src/box0.png"
                            tomb[i][j] = 0;
                            p++;
                    }
                    }
                }
                check();
                fill();
                pontszam += p;
                cl++;
            }
            
            document.getElementById("click").innerHTML = cl;
            document.getElementById("score").innerHTML = pontszam;
        }


    function over(i, j){
        if(tomb[i][j] != 0){
            ocurrent = tomb[i][j];
            setbg(i,j,"magenta");
            for (let i = 0; i < 6; i++){
                    for (let j = 0; j < 10; j++){
                        if (document.getElementById(i+"x"+j).getAttribute("class") == "magenta"){
                            chosen++;
                        }
                    }
                }
            if (chosen < 3){
                for (let i = 0; i < 6; i++){
                    for (let j = 0; j < 10; j++){
                        if (document.getElementById(i+"x"+j).getAttribute("class") == "magenta"){
                            document.getElementById(i+"x"+j).setAttribute("onclick", "setbg(\""+i+"\",\""+j+"\",\""+"red"+"\");");
                        }
                    }
                }
            }
        }
        }

    function out(i,j){
        if (tomb[i][j] != 0){
        ocurrent = tomb[i][j];
        setbg(i,j,"none");
        for (let i = 0; i < 6; i++){
                    for (let j = 0; j < 10; j++){
                        if (document.getElementById(i+"x"+j).getAttribute("onclick") == "setbg(\""+i+"\",\""+j+"\",\""+"red"+"\");"){
                            document.getElementById(i+"x"+j).setAttribute("onclick", "katt(\""+i+"\",\""+j+"\");");
                        }
                    }
                }
        chosen = 0;
        }
    }

    function wrong(i,j){
        console.log("wrong: "+i+" "+j);
        document.getElementById(i+"x"+j).setAttribute("class", "red");
    }

    function setbg(i, j, color){
        let ii = i;
        let jj = j;
            if (tomb[ii][jj] == ocurrent && document.getElementById(ii+"x"+jj).getAttribute("class") != color){
                if (ii > 0){
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                    setbg(ii-1, j, color);
                }else{
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                }

                if (jj > 0){
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                    setbg(i, jj-1, color);
                }else{
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                }
                
                if (ii < 5){
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                    setbg(ii*1+1, j, color);
                }else{
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                }

                if (jj < 9){
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                    setbg(i, jj*1+1, color);
                }else{
                    document.getElementById(ii+"x"+jj).setAttribute("class",color);
                }
            }else{
                return;
            }
    }

    function check(){
            for (let i = 5; i >= 0; i--){
                for (let j = 0; j < 10; j++){
                   let k = 0;
                   let x = i;
                   if(tomb[x][j] == 0){
                        if (x != 0){
                            while(tomb[x][j] == 0 && x > 0){
                                x--;
                                k++;  
                            }
                        }
                        tomb[i][j] = tomb[i-k][j];
                        document.getElementById(i+"x"+j).src = "src/box"+tomb[i-k][j]+".png";
                        tomb[i-k][j] = 0;
                        document.getElementById((i-k)+"x"+j).src = "src/box0.png";
                   }
                }
            }
        }

    function fill(){
        for (let i = 5; i >= 0; i--){
            for (let j = 0; j < 10; j++){
                if (tomb[i][j] == 0){ 
                    let v = Math.floor(Math.random()*5+1);
                    tomb[i][j] = v;
                    document.getElementById(i+"x"+j).src = "src/box"+v+".png";
                }
            }
        }
    }

    </script>
</head>
<body onload="start();">
    
    <div id="container">


    </div>
    <div id="scoreboard">
        <p>Score: <span id="score">0</span></p>
        <p>Clicks: <span id="click">0</span></p>
        <div id="buttons"> 
            <input onclick="start();" type="button" value="NEW GAME">
            <a href="menu.html"><input type="button" value="MENU"></a>
        </div>
       
    </div>
    
</body>
</html>
